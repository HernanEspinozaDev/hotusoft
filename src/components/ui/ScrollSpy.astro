---
// Scroll Spy Sidebar Navigation
const sections = [
  { id: 'hero', name: 'Inicio' },
  { id: 'nosotros', name: 'Nosotros' },
  { id: 'comparativa', name: 'Comparativa' },
  { id: 'servicios', name: 'Servicios' },
  { id: 'precios', name: 'Precios' },
  { id: 'contacto', name: 'Contacto' },
];
---

<!-- Scroll Spy Sidebar (Desktop only) -->
<nav id="scroll-spy-nav" class="hidden lg:flex fixed left-0 top-1/2 -translate-y-1/2 z-40 flex-col" aria-label="Navegacion de secciones">
  {sections.map((section, index) => (
    <a 
      href={"#" + section.id}
      data-section={section.id}
      class="scroll-spy-item group flex items-center gap-3 py-2 pl-4 pr-6 transition-all duration-300"
    >
      <!-- Bar indicator -->
      <span class="scroll-spy-bar w-1 h-8 bg-slate-300 group-hover:bg-blue-600 rounded-full transition-all duration-300"></span>
      <!-- Label -->
      <span class="scroll-spy-label text-sm font-medium text-slate-400 group-hover:text-blue-600 opacity-0 group-hover:opacity-100 translate-x-2 group-hover:translate-x-0 transition-all duration-300 whitespace-nowrap">
        {section.name}
      </span>
    </a>
  ))}
</nav>

<style>
  .scroll-spy-item.active .scroll-spy-bar {
    background-color: #2563eb;
    width: 0.375rem;
    height: 2.5rem;
  }
  
  .scroll-spy-item.active .scroll-spy-label {
    color: #2563eb;
    opacity: 1;
    transform: translateX(0);
    font-weight: 600;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('section[id]');
    const navItems = document.querySelectorAll('.scroll-spy-item');
    const navbarLinks = document.querySelectorAll('header nav a[href^="#"]');
    
    // Function to set active section
    function setActiveSection(sectionId: string) {
      navItems.forEach(item => {
        const itemSection = item.getAttribute('data-section');
        if (itemSection === sectionId) {
          item.classList.add('active');
        } else {
          item.classList.remove('active');
        }
      });
    }
    
    // Scroll spy using Intersection Observer
    const observerOptions = {
      root: null,
      rootMargin: '-20% 0px -70% 0px',
      threshold: 0
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          setActiveSection(entry.target.id);
        }
      });
    }, observerOptions);
    
    sections.forEach(section => {
      observer.observe(section);
    });
    
    // Sync with navbar clicks
    navbarLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (href && href.startsWith('#')) {
          const sectionId = href.substring(1);
          // Set active immediately on click
          setTimeout(() => setActiveSection(sectionId), 100);
        }
      });
    });
    
    // Sync scroll spy clicks with navbar state
    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const sectionId = item.getAttribute('data-section');
        if (sectionId) {
          setActiveSection(sectionId);
        }
      });
    });
    
    // Set initial active section
    setActiveSection('hero');
  });
</script>
